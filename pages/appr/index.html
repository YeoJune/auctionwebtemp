<!-- pages/appr/index.html -->
<!-- 메인 페이지 -->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CAS 명품감정시스템</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Montserrat:wght@500;600;700&display=swap"
      rel="stylesheet" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Noto Sans KR", sans-serif;
        color: #333;
        line-height: 1.6;
        background-color: #fff;
      }

      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }
      /* 헤더 & 푸터 공통 스타일 (다른 appr 페이지에서 가져옴) */

      header {
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .header-inner {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px 0;
        max-width: 1200px;
        margin: 0 auto;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 40px;
      }

      .logo {
        font-size: 1.6rem;
        font-weight: 700;
        color: #1a2a3a;
        text-decoration: none;
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
      }

      .logo .cas-highlight {
        background: linear-gradient(135deg, #1a2a3a 0%, #2d4263 100%);
        -background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      /* 페이지 전환 관련 스타일 */

      .page {
        display: none;
      }

      .page.active {
        display: block;
      }
      /* 슬라이더 관련 스타일 */

      .slider-item {
        opacity: 0;
        transition: opacity 1s ease-in-out;
      }

      .slider-item.active {
        opacity: 1;
      }
      /* 반응형 그리드 설정 */

      @media (min-width: 768px) {
        .nav-desktop {
          display: flex !important;
          gap: 8px;
        }
        .mobile-menu-btn {
          display: none !important;
        }
        .grid-2 {
          grid-template-columns: repeat(2, 1fr) !important;
        }
        .grid-3 {
          grid-template-columns: repeat(3, 1fr) !important;
        }
        .grid-4 {
          grid-template-columns: repeat(4, 1fr) !important;
        }
        .process-line {
          display: block !important;
        }
      }

      @media (min-width: 1024px) {
        .nav-desktop {
          gap: 12px;
        }
        .nav-desktop a {
          padding: 8px 16px;
          font-size: 1rem;
        }
      }
      /* 모던 디자인 요소 */

      .glass-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .gradient-bg {
        background: linear-gradient(135deg, #f6f9fc 0%, #eef2f8 100%);
      }

      .gradient-primary {
        background: linear-gradient(135deg, #1a2a3a 0%, #2d4263 100%);
      }

      .btn-modern {
        padding: 14px 28px;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-modern:before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        z-index: -1;
      }

      .btn-modern:hover:before {
        width: 100%;
      }

      .fade-in {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.6s ease;
      }

      .fade-in.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .input-modern {
        border: none;
        background-color: #f8fafc;
        border-radius: 8px;
        padding: 16px;
        font-size: 1rem;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
      }

      .input-modern:focus {
        outline: none;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1),
          0 0 0 2px rgba(26, 42, 58, 0.2);
      }

      .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .nav-desktop {
        display: none;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;
        justify-content: flex-end;
      }

      .nav-desktop a {
        color: #333;
        text-decoration: none;
        font-weight: 500;
        white-space: nowrap;
        padding: 8px 12px;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.95rem;
      }

      .nav-desktop a:hover {
        color: #666;
        background-color: rgba(0, 0, 0, 0.05);
      }

      .mobile-menu-btn {
        display: block;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <!-- 헤더 -->
    <header
      style="
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        position: sticky;
        top: 0;
        z-index: 1000;
      ">
      <div class="container">
        <div class="header-inner">
          <div class="header-left">
            <a href="/appr" class="logo">
              <img
                src="https://i.ibb.co/FqJhVh0T/image.png"
                alt="CAS 명품감정시스템"
                style="height: 40px" />
            </a>

            <nav class="nav-desktop">
              <a href="/appr" class="btn-modern">홈</a>
              <a href="/appr/request" class="btn-modern">감정신청</a>
              <a href="/appr/result" class="btn-modern">감정번호조회</a>
              <a href="/appr/mypage" class="btn-modern">마이페이지</a>
              <a href="/appr/repair" class="btn-modern">까사복원시스템</a>
              <a href="/appr/authenticity" class="btn-modern">정가품구별법</a>
              <a href="/appr/signin" class="btn-modern">로그인</a>
            </nav>
          </div>

          <button
            class="mobile-menu-btn"
            id="menu-icon"
            onclick="toggleMobileMenu()">
            ☰
          </button>
        </div>
      </div>
    </header>

    <div
      class="mobile-menu"
      id="mobile-menu"
      style="
        display: none;
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background-color: #fff;
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        z-index: 999;
      ">
      <a
        href="/appr"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
          border-bottom: 1px solid #e2e8f0;
        "
        >홈</a
      >
      <a
        href="/appr/request"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
          border-bottom: 1px solid #e2e8f0;
        "
        >감정신청</a
      >
      <a
        href="/appr/result"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
          border-bottom: 1px solid #e2e8f0;
        "
        >감정번호조회</a
      >
      <a
        href="/appr/mypage"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
          border-bottom: 1px solid #e2e8f0;
        "
        >마이페이지</a
      >
      <a
        href="/appr/repair"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
          border-bottom: 1px solid #e2e8f0;
        "
        >까사복원시스템</a
      >
      <a
        href="/appr/authenticity"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
          border-bottom: 1px solid #e2e8f0;
        "
        >정가품구별법</a
      >
      <a
        href="/appr/signin"
        style="
          display: block;
          padding: 15px 20px;
          color: #4a5568;
          text-decoration: none;
        "
        >로그인</a
      >
    </div>

    <!-- 메인 콘텐츠 영역 -->
    <main>
      <!-- 홈페이지 -->
      <div id="home" class="page active">
        <!-- 메인 비주얼 섹션 (슬라이더) -->
        <section
          class="main-slider"
          style="
            position: relative;
            height: 650px;
            overflow: hidden;
            border-radius: 0 0 30px 30px;
          ">
          <div class="slider-container" style="width: 100%; height: 100%">
            <div
              class="slider-item active"
              style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #1a2a3a 0%, #2d4263 100%);
              ">
              <div
                style="
                  position: absolute;
                  top: 0;
                  left: 0;
                  right: 0;
                  bottom: 0;
                  background-image: url('https://i.ibb.co/RTnppKwn/freepik-the-style-is-candid-image-photography-with-natural-80904.jpg');
                  background-size: cover;
                  background-position: center;
                  opacity: 0.7;
                  mix-blend-mode: overlay;
                "></div>

              <div
                style="
                  position: absolute;
                  top: 0;
                  left: 0;
                  width: 100%;
                  height: 100%;
                  display: flex;
                  align-items: center;
                ">
                <div
                  class="container"
                  style="max-width: 1200px; margin: 0 auto; padding: 0 20px">
                  <div
                    style="max-width: 600px; color: #fff"
                    class="fade-in visible">
                    <h1
                      style="
                        font-size: 3.5rem;
                        font-weight: 700;
                        margin-bottom: 20px;
                        line-height: 1.2;
                        letter-spacing: -1px;
                      ">
                      정확한<br /><span style="color: #e2e8f0">명품감정</span>
                    </h1>
                    <p
                      style="
                        font-size: 1.25rem;
                        margin-bottom: 30px;
                        color: rgba(255, 255, 255, 0.9);
                        line-height: 1.6;
                      ">
                      국내 최고 전문가의 정밀한 감정 서비스로<br />소중한 명품의
                      가치를 확인하세요.
                    </p>
                    <div style="display: flex; gap: 15px">
                      <a
                        href="/appr/request"
                        class="btn-modern"
                        style="
                          padding: 15px 30px;
                          background-color: #fff;
                          color: #1a2a3a;
                          text-decoration: none;
                          font-weight: 600;
                          border-radius: 8px;
                          transition: all 0.3s;
                        ">
                        감정 신청하기
                      </a>
                      <a
                        href="/appr/result"
                        class="btn-modern"
                        style="
                          padding: 15px 30px;
                          background-color: transparent;
                          color: #fff;
                          text-decoration: none;
                          font-weight: 600;
                          border-radius: 8px;
                          border: 1px solid rgba(255, 255, 255, 0.7);
                          transition: all 0.3s;
                        ">
                        감정서 조회하기
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- 최근 감정 내역 섹션 -->
        <section
          id="recent-appraisals"
          style="padding: 40px 0; background-color: #fff">
          <div
            class="container"
            style="max-width: 1200px; margin: 0 auto; padding: 0 20px">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
              ">
              <p style="color: #4a5568; font-size: 1.1rem">
                명품감정
                <span id="count-display"
                  >전체 <strong id="total-appraisals-count">0</strong></span
                >
                건
              </p>
              <div
                class="toggle-container"
                style="
                  display: flex;
                  align-items: center;
                  background-color: #f1f5f9;
                  border-radius: 20px;
                  padding: 4px;
                ">
                <button
                  id="toggle-all"
                  class="toggle-btn active"
                  style="
                    cursor: pointer;
                    padding: 6px 12px;
                    border-radius: 16px;
                    border: none;
                    background-color: #1a2a3a;
                    color: white;
                    font-weight: 500;
                    transition: all 0.2s ease;
                  ">
                  전체
                </button>
                <button
                  id="toggle-today"
                  class="toggle-btn"
                  style="
                    cursor: pointer;
                    padding: 6px 12px;
                    border-radius: 16px;
                    border: none;
                    background-color: transparent;
                    font-weight: 500;
                    transition: all 0.2s ease;
                  ">
                  오늘
                </button>
              </div>
            </div>
            <div
              id="appraisal-list-container"
              style="
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
                max-height: 500px;
                overflow-y: auto;
              ">
              <!-- 감정 내역이 여기에 동적으로 추가됩니다. -->
              <p
                id="loading-appraisals"
                style="padding: 15px; text-align: center; color: #4a5568">
                감정 내역을 불러오는 중...
              </p>
            </div>
          </div>
        </section>

        <!-- 서비스 소개 섹션 -->
        <section style="padding: 80px 0; background-color: #f8fafc">
          <div
            class="container"
            style="max-width: 1200px; margin: 0 auto; padding: 0 20px">
            <div
              style="
                text-align: center;
                max-width: 800px;
                margin: 0 auto 60px auto;
              ">
              <h2
                style="
                  font-size: 2.25rem;
                  font-weight: 700;
                  color: #1a2a3a;
                  margin-bottom: 20px;
                ">
                CAS 명품감정시스템
              </h2>
              <p style="color: #4a5568; font-size: 1.1rem; line-height: 1.7">
                CAS 명품감정시스템의 전문가들은 수십 년의 경험을 바탕으로
                정확하고 신뢰할 수 있는 감정 서비스를 제공합니다. 까다로운 내부
                검증 시스템으로 항상 최고 수준의 감정 결과를 보장합니다.
              </p>
            </div>

            <div
              style="
                display: grid;
                grid-template-columns: repeat(1, 1fr);
                gap: 30px;
              "
              class="grid-3">
              <div
                class="service-card"
                style="
                  background-color: #fff;
                  padding: 40px 30px;
                  border-radius: 8px;
                  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s;
                ">
                <div
                  style="
                    width: 70px;
                    height: 70px;
                    background-color: #ebf4ff;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 12px;
                    margin-bottom: 25px;
                  ">
                  <span style="font-size: 1.75rem">🔗</span>
                </div>
                <h3
                  style="
                    font-size: 1.3rem;
                    font-weight: 700;
                    color: #1a2a3a;
                    margin-bottom: 15px;
                  ">
                  퀵링크 감정
                </h3>
                <p style="color: #4a5568; line-height: 1.7">
                  간편한 링크 공유로 빠른 감정 서비스를 제공합니다. 판매자와
                  구매자 모두가 신뢰할 수 있는 중립적인 감정 결과를 확인하세요.
                </p>
              </div>

              <div
                class="service-card"
                style="
                  background-color: #fff;
                  padding: 40px 30px;
                  border-radius: 8px;
                  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s;
                ">
                <div
                  style="
                    width: 70px;
                    height: 70px;
                    background-color: #ebf4ff;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 12px;
                    margin-bottom: 25px;
                  ">
                  <span style="font-size: 1.75rem">✓</span>
                </div>
                <h3
                  style="
                    font-size: 1.3rem;
                    font-weight: 700;
                    color: #1a2a3a;
                    margin-bottom: 15px;
                  ">
                  오프라인 실물 감정
                </h3>
                <p style="color: #4a5568; line-height: 1.7">
                  오프라인 매장에서 실물을 직접 확인하는 정밀 감정 서비스를
                  제공합니다. 더 자세한 상태 확인이 필요한 경우 추천합니다.
                </p>
              </div>

              <div
                class="service-card"
                style="
                  background-color: #fff;
                  padding: 40px 30px;
                  border-radius: 8px;
                  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
                  transition: all 0.3s;
                ">
                <div
                  style="
                    width: 70px;
                    height: 70px;
                    background-color: #ebf4ff;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 12px;
                    margin-bottom: 25px;
                  ">
                  <span style="font-size: 1.75rem">⏱</span>
                </div>
                <h3
                  style="
                    font-size: 1.3rem;
                    font-weight: 700;
                    color: #1a2a3a;
                    margin-bottom: 15px;
                  ">
                  공식 감정서 발급
                </h3>
                <p style="color: #4a5568; line-height: 1.7">
                  QR코드가 포함된 공식 감정서를 발급해 드립니다. 위변조가
                  불가능하며 언제든지 진위 확인이 가능합니다.
                </p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- 푸터 -->
    <footer
      style="background-color: #1a2a3a; color: #fff; padding: 40px 0 20px">
      <div class="container">
        <div
          style="
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 30px;
            margin-bottom: 30px;
          "
          class="grid-3">
          <div>
            <h3
              style="font-size: 1.25rem; font-weight: 700; margin-bottom: 15px">
              <span style="font-size: 0.9rem; vertical-align: top">ⓒ</span> CAS
              명품감정시스템
            </h3>
            <p style="color: #cbd5e0; margin-bottom: 20px">
              최고의 전문가들이 함께하는<br />
              국내 최고 명품 감정 서비스
            </p>
          </div>

          <div>
            <h3
              style="font-size: 1.1rem; font-weight: 700; margin-bottom: 15px">
              서비스
            </h3>
            <ul style="list-style: none; padding: 0; margin: 0">
              <li style="margin-bottom: 10px">
                <a
                  href="/appr/request"
                  style="color: #cbd5e0; text-decoration: none"
                  >감정 신청</a
                >
              </li>
              <li style="margin-bottom: 10px">
                <a
                  href="/appr/result"
                  style="color: #cbd5e0; text-decoration: none"
                  >감정서 조회</a
                >
              </li>
              <li style="margin-bottom: 10px">
                <a
                  href="/appr/repair"
                  style="color: #cbd5e0; text-decoration: none"
                  >까사복원시스템</a
                >
              </li>
              <li style="margin-bottom: 10px">
                <a
                  href="/appr/authenticity"
                  style="color: #cbd5e0; text-decoration: none"
                  >정가품구별법</a
                >
              </li>
              <li>
                <a
                  href="/appr/mypage"
                  style="color: #cbd5e0; text-decoration: none"
                  >마이페이지</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3
              style="font-size: 1.1rem; font-weight: 700; margin-bottom: 15px">
              정보
            </h3>
            <ul style="list-style: none; padding: 0; margin: 0">
              <li style="margin-bottom: 10px">
                <a href="#" style="color: #cbd5e0; text-decoration: none"
                  >회사 소개</a
                >
              </li>
              <li style="margin-bottom: 10px">
                <a href="#" style="color: #cbd5e0; text-decoration: none"
                  >이용약관</a
                >
              </li>
              <li>
                <a href="#" style="color: #cbd5e0; text-decoration: none"
                  >개인정보처리방침</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div
          style="
            border-top: 1px solid #2d3748;
            padding-top: 20px;
            text-align: center;
            color: #a0aec0;
            font-size: 0.875rem;
          ">
          <p>© 2025 CAS 명품감정시스템. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      function toggleMobileMenu() {
        const mobileMenu = document.getElementById("mobile-menu");
        const menuIcon = document.getElementById("menu-icon");
        if (mobileMenu.style.display === "block") {
          mobileMenu.style.display = "none";
          if (menuIcon) menuIcon.textContent = "☰";
        } else {
          mobileMenu.style.display = "block";
          if (menuIcon) menuIcon.textContent = "✕";
        }
      }

      let currentSlide = 0;
      const slides = document.querySelectorAll(".slider-item");
      function changeSlide(n) {
        if (slides.length === 0) return;
        slides[currentSlide].classList.remove("active");
        currentSlide = n;
        slides[currentSlide].classList.add("active");
      }
      if (slides.length > 1) {
        setInterval(() => {
          let nextSlide = currentSlide + 1;
          if (nextSlide >= slides.length) nextSlide = 0;
          changeSlide(nextSlide);
        }, 5000);
      }

      document.addEventListener("DOMContentLoaded", function () {
        const mobileMenuButton = document.querySelector(".mobile-menu-btn");
        const navDesktop = document.querySelector(".nav-desktop");

        function handleResponsiveLayout() {
          if (window.innerWidth >= 768) {
            // 768px 이상에서는 데스크톱 메뉴 표시
            if (navDesktop) navDesktop.style.display = "flex";
            if (mobileMenuButton) mobileMenuButton.style.display = "none";
            const mobileMenu = document.getElementById("mobile-menu");
            if (mobileMenu) mobileMenu.style.display = "none";
          } else {
            if (navDesktop) navDesktop.style.display = "none";
            if (mobileMenuButton) mobileMenuButton.style.display = "block";
          }
        }
        handleResponsiveLayout();
        window.addEventListener("resize", handleResponsiveLayout);

        function handleScrollAnimations() {
          const elements = document.querySelectorAll(".fade-in");
          elements.forEach((element) => {
            const position = element.getBoundingClientRect();
            if (
              position.top < window.innerHeight * 0.85 &&
              position.bottom >= 0
            ) {
              element.classList.add("visible");
            }
          });
        }
        window.addEventListener("scroll", handleScrollAnimations);
        handleScrollAnimations();

        // --- 최근 감정 내역 데이터 로드 ---
        const totalAppraisalsCountEl = document.getElementById(
          "total-appraisals-count"
        );
        const countDisplayEl = document.getElementById("count-display");
        const appraisalListContainer = document.getElementById(
          "appraisal-list-container"
        );
        const loadingAppraisalsEl =
          document.getElementById("loading-appraisals");
        const toggleAllBtn = document.getElementById("toggle-all");
        const toggleTodayBtn = document.getElementById("toggle-today");

        let isToday = false; // 초기값은 전체 보기

        // 토글 버튼 이벤트 리스너
        toggleAllBtn.addEventListener("click", function () {
          if (!isToday) return;
          isToday = false;
          toggleAllBtn.classList.add("active");
          toggleAllBtn.style.backgroundColor = "#1a2a3a";
          toggleAllBtn.style.color = "white";
          toggleTodayBtn.classList.remove("active");
          toggleTodayBtn.style.backgroundColor = "transparent";
          toggleTodayBtn.style.color = "#1a2a3a";
          countDisplayEl.innerHTML = `전체 <strong id="total-appraisals-count">${totalAppraisalsCountEl.textContent}</strong>`;
          loadAppraisals(false);
        });

        toggleTodayBtn.addEventListener("click", function () {
          if (isToday) return;
          isToday = true;
          toggleTodayBtn.classList.add("active");
          toggleTodayBtn.style.backgroundColor = "#1a2a3a";
          toggleTodayBtn.style.color = "white";
          toggleAllBtn.classList.remove("active");
          toggleAllBtn.style.backgroundColor = "transparent";
          toggleAllBtn.style.color = "#1a2a3a";
          countDisplayEl.innerHTML = `오늘 <strong id="total-appraisals-count">${totalAppraisalsCountEl.textContent}</strong>`;
          loadAppraisals(true);
        });

        // 감정 내역 로드 함수
        function loadAppraisals(todayOnly) {
          if (loadingAppraisalsEl) loadingAppraisalsEl.style.display = "block";
          if (appraisalListContainer) appraisalListContainer.innerHTML = "";
          appraisalListContainer.appendChild(loadingAppraisalsEl);

          let url = "/api/appr/appraisals?limit=0";
          if (todayOnly) {
            url += "&today=true";
          }

          fetch(url)
            .then((response) => response.json())
            .then((data) => {
              if (loadingAppraisalsEl)
                loadingAppraisalsEl.style.display = "none";
              if (
                data.success &&
                data.appraisals &&
                data.appraisals.length > 0
              ) {
                totalAppraisalsCountEl.textContent =
                  data.pagination.totalItems.toLocaleString();

                data.appraisals.forEach((appraisal) => {
                  const itemDiv = document.createElement("div");
                  itemDiv.className = "appraisal-item";
                  itemDiv.setAttribute(
                    "data-certificate",
                    appraisal.certificate_number
                  );
                  itemDiv.style.display = "grid";
                  itemDiv.style.gridTemplateColumns = "1fr auto";
                  itemDiv.style.gap = "15px";
                  itemDiv.style.padding = "15px";
                  itemDiv.style.borderBottom = "1px solid #e2e8f0";
                  itemDiv.style.alignItems = "center";
                  itemDiv.style.cursor = "pointer";

                  const infoDiv = document.createElement("div");
                  infoDiv.className = "appraisal-info";

                  const titleP = document.createElement("p");
                  titleP.style.fontWeight = "500";
                  titleP.style.color = "#1a2a3a";
                  titleP.style.marginBottom = "5px";

                  const typeSpan = document.createElement("span");
                  typeSpan.className = "appraisal-type";
                  typeSpan.style.backgroundColor = "#e6eefa";
                  typeSpan.style.color = "#1a4ea3";
                  typeSpan.style.padding = "3px 8px";
                  typeSpan.style.borderRadius = "4px";
                  typeSpan.style.fontSize = "0.75rem";
                  typeSpan.style.marginRight = "5px";

                  // appraisal_type에 따라 텍스트 설정
                  let appraisalTypeText = "온라인 사진 명품 감정";
                  if (appraisal.appraisal_type === "quicklink") {
                    appraisalTypeText = "퀵링크 감정";
                  } else if (appraisal.appraisal_type === "offline") {
                    appraisalTypeText = "오프라인 실물 명품 감정";
                  }
                  typeSpan.textContent = appraisalTypeText;

                  titleP.appendChild(typeSpan);
                  titleP.appendChild(
                    document.createTextNode(
                      ` ${appraisal.brand || ""} ${
                        appraisal.model_name || ""
                      }`.trim()
                    )
                  );

                  const metaP = document.createElement("p");
                  metaP.style.fontSize = "0.875rem";
                  metaP.style.color = "#4a5568";
                  const date = new Date(appraisal.created_at).toLocaleString(
                    "ko-KR",
                    {
                      year: "numeric",
                      month: "2-digit",
                      day: "2-digit",
                      hour: "2-digit",
                      minute: "2-digit",
                    }
                  );
                  metaP.textContent = `감정번호: ${appraisal.certificate_number} | 신청일: ${date}`;

                  infoDiv.appendChild(titleP);
                  infoDiv.appendChild(metaP);

                  const statusDiv = document.createElement("div");
                  statusDiv.className = "appraisal-status";
                  const statusSpan = document.createElement("span");
                  statusSpan.style.padding = "5px 10px";
                  statusSpan.style.borderRadius = "4px";
                  statusSpan.style.fontSize = "0.75rem";
                  if (appraisal.status === "completed") {
                    statusSpan.textContent = "감정완료";
                    statusSpan.style.backgroundColor = "#d1fae5";
                    statusSpan.style.color = "#059669";
                  } else if (appraisal.status === "in_review") {
                    statusSpan.textContent = "감정중";
                    statusSpan.style.backgroundColor = "#e0f2fe";
                    statusSpan.style.color = "#0369a1";
                  } else if (appraisal.status === "pending") {
                    statusSpan.textContent = "접수완료";
                    statusSpan.style.backgroundColor = "#e0f2fe";
                    statusSpan.style.color = "#0369a1";
                  } else if (appraisal.status === "cancelled") {
                    statusSpan.textContent = "취소됨";
                    statusSpan.style.backgroundColor = "#f1f5f9";
                    statusSpan.style.color = "#334155";
                  } else {
                    statusSpan.textContent = appraisal.status; // 기타 상태 그대로 표시
                    statusSpan.style.backgroundColor = "#f1f5f9";
                    statusSpan.style.color = "#334155";
                  }
                  statusDiv.appendChild(statusSpan);

                  itemDiv.appendChild(infoDiv);
                  itemDiv.appendChild(statusDiv);
                  if (appraisalListContainer) {
                    appraisalListContainer.appendChild(itemDiv);
                  }

                  // 클릭 이벤트 리스너 추가
                  itemDiv.addEventListener("click", function () {
                    const certificateNumber =
                      this.getAttribute("data-certificate");
                    if (certificateNumber) {
                      window.location.href = `https://casastrade.com/appr/result/${certificateNumber}`;
                    }
                  });
                });
              } else if (data.appraisals && data.appraisals.length === 0) {
                if (appraisalListContainer)
                  appraisalListContainer.innerHTML =
                    '<p style="padding: 15px; text-align: center; color: #4a5568;">감정 내역이 없습니다.</p>';
                totalAppraisalsCountEl.textContent = "0";
              } else {
                if (appraisalListContainer)
                  appraisalListContainer.innerHTML =
                    '<p style="padding: 15px; text-align: center; color: #dc2626;">감정 내역을 불러오는데 실패했습니다.</p>';
              }
            })
            .catch((error) => {
              console.error("감정 목록 로드 실패:", error);
              if (loadingAppraisalsEl)
                loadingAppraisalsEl.style.display = "none";
              if (appraisalListContainer)
                appraisalListContainer.innerHTML =
                  '<p style="padding: 15px; text-align: center; color: #dc2626;">감정 내역 로드 중 오류 발생.</p>';
            });
        }

        // 초기 데이터 로드 (전체)
        loadAppraisals(false);
        // --- 최근 감정 내역 데이터 로드 끝 ---

        document
          .querySelectorAll('a[href^="request.html?tab="]')
          .forEach((link) => {
            const tabName = new URL(
              link.href,
              window.location.origin
            ).searchParams.get("tab");
            if (tabName) link.href = `/appr/request?tab=${tabName}`;
          });

        // 상세 페이지 이동 핸들러 추가 (감정 결과 클릭시)
        document.querySelectorAll(".appraisal-item").forEach((item) => {
          item.addEventListener("click", function () {
            const appraisalId = this.getAttribute("data-id");
            if (appraisalId) {
              window.location.href = `/appr/quick-result/${appraisalId}`;
            }
          });
        });

        const certificateSearchForm = document.getElementById(
          "certificate-search-form"
        ); // 폼 ID가 이것이라고 가정
        if (certificateSearchForm) {
          certificateSearchForm.addEventListener("submit", function (event) {
            event.preventDefault();
            const certificateNumberInput =
              document.getElementById("certificate-number"); // 입력 필드 ID
            if (certificateNumberInput && certificateNumberInput.value.trim()) {
              window.location.href = `/appr/result/${encodeURIComponent(
                certificateNumberInput.value.trim()
              )}`;
            } else {
              alert("감정번호를 입력해주세요.");
            }
          });
        }
      });
      // 로그인 상태에 따라 로그인/로그아웃 버튼을 변경하는 함수
      function updateAuthButton() {
        // 서버에 로그인 상태 확인 API 호출
        fetch("/api/auth/user", {
          method: "GET",
          credentials: "include", // 쿠키를 포함하여 요청 전송
        })
          .then((response) => response.json())
          .then((data) => {
            // 로그인 버튼 요소들 가져오기 (데스크톱 및 모바일)
            const desktopAuthButton = document.querySelector(
              '.nav-desktop a[href="/appr/signin"]'
            );
            const mobileAuthButton = document.querySelector(
              '#mobile-menu a[href="/appr/signin"]'
            );

            if (data.user && data.user.id) {
              // 사용자가 로그인된 경우, 로그인 버튼을 로그아웃 버튼으로 변경
              if (desktopAuthButton) {
                desktopAuthButton.textContent = "로그아웃";
                desktopAuthButton.setAttribute("href", "#");
                desktopAuthButton.addEventListener("click", handleLogout);
              }

              if (mobileAuthButton) {
                mobileAuthButton.textContent = "로그아웃";
                mobileAuthButton.setAttribute("href", "#");
                mobileAuthButton.addEventListener("click", handleLogout);
              }
            }
          })
          .catch((error) => {
            console.error("로그인 상태 확인 중 오류 발생:", error);
          });
      }

      // 로그아웃 처리 함수
      function handleLogout(event) {
        event.preventDefault();

        fetch("/api/auth/logout", {
          method: "POST",
          credentials: "include", // 쿠키를 포함하여 요청 전송
        })
          .then((response) => {
            if (response.ok) {
              // 로그아웃 성공 시 페이지 새로고침
              window.location.reload();
            } else {
              console.error("로그아웃 실패");
            }
          })
          .catch((error) => {
            console.error("로그아웃 처리 중 오류 발생:", error);
          });
      }

      // DOMContentLoaded 이벤트 리스너 추가
      document.addEventListener("DOMContentLoaded", function () {
        updateAuthButton();
      });
    </script>
  </body>
</html>
