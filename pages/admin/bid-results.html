<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>입찰 결과 및 정산 관리</title>
    <link rel="stylesheet" href="/styles/common.css" />
    <link rel="stylesheet" href="/styles/admin/common.css" />
    <link rel="stylesheet" href="/styles/admin/bids.css" />
    <link rel="stylesheet" href="/styles/admin/bid-results.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  </head>
  <body>
    <div class="admin-layout">
      <!-- 사이드바 -->
      <div class="sidebar">
        <div class="sidebar-logo">
          <h2>경매 관리자</h2>
        </div>
        <div class="sidebar-menu">
          <a href="/admin">대시보드</a>
          <a href="/admin/live-bids">현장 경매 관리</a>
          <a href="/admin/direct-bids">직접 경매 관리</a>
          <a href="/admin/all-bids">통합 경매 관리</a>
          <a href="/admin/bid-results" class="active">입찰 결과 & 정산</a>
          <a href="/admin/transactions">거래 내역 관리</a>
          <a href="/admin/invoices">인보이스 관리</a>
          <a href="/admin/users">회원 관리</a>
          <a href="/admin/recommend-filters">추천 및 필터</a>
          <a href="/admin/settings">관리자 설정</a>
        </div>
      </div>

      <!-- 메인 콘텐츠 -->
      <div class="main-content">
        <div class="main-header">
          <h1>입찰 결과 & 정산 관리</h1>
          <div class="user-info" style="display: flex; align-items: center">
            <div class="admin-switch">
              <a href="#" class="active">경매 관리</a>
              <a href="https://cassystem.com/admin" class="inactive"
                >명품감정</a
              >
            </div>
            관리자
            <button id="logoutBtn" class="btn btn-secondary">로그아웃</button>
          </div>
        </div>

        <!-- 검색 및 필터 영역 -->
        <div class="search-section">
          <div class="search-input-group">
            <input
              type="text"
              id="searchInput"
              placeholder="유저ID, 날짜(YYYY-MM-DD) 검색..." />
            <button id="searchBtn" class="btn">검색</button>
            <button id="clearSearchBtn" class="btn btn-secondary">
              초기화
            </button>
          </div>
        </div>

        <!-- 필터 탭 -->
        <div class="filter-tabs">
          <div class="filter-tab active" data-status="">전체</div>
          <div class="filter-tab" data-status="pending">미결제</div>
          <div class="filter-tab" data-status="paid">결제 완료</div>
        </div>

        <!-- 정렬 및 페이지 크기 -->
        <div class="filter-options">
          <div class="sort-options">
            <div class="sort-field">
              <label for="sortBy">정렬 기준:</label>
              <select id="sortBy" class="form-control form-control-sm">
                <option value="date">날짜</option>
                <option value="total_price">총 금액</option>
                <option value="item_count">상품 수</option>
              </select>
            </div>
            <div class="sort-order">
              <label for="sortOrder">정렬 방향:</label>
              <select id="sortOrder" class="form-control form-control-sm">
                <option value="desc">내림차순</option>
                <option value="asc">오름차순</option>
              </select>
            </div>
          </div>

          <div class="page-size-selector">
            <label for="pageSize">페이지당 항목:</label>
            <select id="pageSize" class="form-control form-control-sm">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
            </select>
          </div>
        </div>

        <!-- 결과 목록 -->
        <div class="card">
          <div class="results-header">
            <div class="results-count">
              총 <span id="totalResults">0</span>건
            </div>
          </div>

          <!-- 로딩 -->
          <div class="loading-msg" id="loadingMsg" style="display: none">
            로딩 중...
          </div>

          <!-- 테이블 -->
          <div class="table-responsive">
            <table class="data-table" id="resultsTable">
              <thead>
                <tr>
                  <th>날짜</th>
                  <th>유저ID</th>
                  <th>상품 수</th>
                  <th>총 청구액 (₩)</th>
                  <th>기 결제액</th>
                  <th>미수금</th>
                  <th>정산 상태</th>
                  <th>입찰 관리</th>
                  <th>정산 관리</th>
                </tr>
              </thead>
              <tbody id="resultsTableBody">
                <tr>
                  <td colspan="9" class="text-center">
                    데이터를 불러오는 중입니다...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- 페이지네이션 -->
          <div class="pagination" id="pagination"></div>
        </div>
      </div>
    </div>

    <!-- 상세 보기 모달 -->
    <div class="modal-overlay" id="detailModal" style="display: none">
      <div class="modal-dialog modal-lg">
        <div class="modal-header">
          <h3>입찰 결과 상세</h3>
          <button class="modal-close" id="detailModalClose">&times;</button>
        </div>
        <div class="modal-body">
          <div id="detailContent">
            <!-- 동적으로 생성 -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="detailCloseBtn">닫기</button>
        </div>
      </div>
    </div>

    <!-- 정산 승인 모달 -->
    <div
      class="modal-overlay"
      id="settlementApprovalModal"
      style="display: none">
      <div class="modal-dialog">
        <div class="modal-header">
          <h3>정산 결제 승인</h3>
          <button class="modal-close" id="settlementModalClose">&times;</button>
        </div>
        <div class="modal-body">
          <div class="settlement-info">
            <div class="info-row">
              <span class="label">유저ID</span>
              <span class="value" id="approvalUserId">-</span>
            </div>
            <div class="info-row">
              <span class="label">정산 날짜</span>
              <span class="value" id="approvalDate">-</span>
            </div>
            <div class="info-row">
              <span class="label">총 청구액</span>
              <span class="value" id="approvalTotal">0원</span>
            </div>
            <div class="info-row">
              <span class="label">기 결제액</span>
              <span class="value" id="approvalCompleted">0원</span>
            </div>
            <div class="info-row highlight">
              <span class="label">입금 확인할 금액</span>
              <span class="value primary" id="approvalRemaining">0원</span>
            </div>
          </div>

          <div class="form-group">
            <label for="adminMemo">관리자 메모 (선택)</label>
            <textarea
              id="adminMemo"
              class="form-control"
              rows="3"
              placeholder="입금 확인 완료 등 메모..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="approvalCancelBtn">취소</button>
          <button class="btn btn-success" id="approvalConfirmBtn">승인</button>
        </div>
      </div>
    </div>

    <script src="/js/api.js"></script>
    <script src="/js/admin/bid-results.js"></script>
  </body>
</html>
